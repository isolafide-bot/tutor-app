name: Build Android APK

on:
  push:
    branches: [ main ]  # main 브랜치에 코드가 올라올 때마다 실행
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1. 깃허브 저장소의 코드를 가져옵니다.
      - uses: actions/checkout@v3

      # 2. 자바(Java) 환경을 설정합니다. (안드로이드 빌드에 필요)
      - name: set up JDK 11
        uses: actions/setup-java@v3
        with:
          java-version: '11'
          distribution: 'temurin'

      # 3. 플러터(Flutter) 환경을 설치합니다.
      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.10.0' # 사용하시는 버전에 맞춰 조절 가능

      # 4. 필요한 패키지(pubspec.yaml에 적은 것들)를 내려받습니다.
      - name: Install dependencies
        run: flutter pub get

      # 5. 안드로이드 APK 파일을 빌드합니다. (Release 모드)
      - name: Build APK
        run: flutter build apk --release

      # 6. 생성된 APK 파일을 깃허브에서 다운로드할 수 있게 업로드합니다.
      - name: Upload APK
        uses: actions/upload-artifact@v3
        with:
          name: tutor-app-release
          path: build/app/outputs/flutter-apk/app-release.apk
